"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),n=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var r={changed:0,blurred:!1,dirty:!1,pristine:!0,filled:!1,value:"",validity:{valid:!1}},l=function(e,t){var n=a({},e,t);return a({},n,{configuration:a({},e.configuration,t.configuration),validity:a({},e.validity,t.validity)})},u=function(e,t){switch(t.type){case"change":return function(e,t){var n,i,r,l,u=a({},e,{changed:e.changed+1,value:t.value,filled:!!t.value}),o=null!=(n=null==(i=t.configuration)?void 0:i.validateOnChange)?n:e.configuration.validateOnChange,d=null!=(r=null==(l=t.configuration)?void 0:l.validate)?r:e.configuration.validate;return o&&(u.dirty=!0,u.pristine=!1,u.validity=d(t.value)),u}(e,t);case"blur":return function(e,t){var n,i,r,l,u=null!=(n=null==(i=t.configuration)?void 0:i.validateOnBlur)?n:e.configuration.validateOnBlur,o=null!=(r=null==(l=t.configuration)?void 0:l.validate)?r:e.configuration.validate;return a({},e,u&&0!==e.changed?{dirty:!0,pristine:!1,blurred:!0,validity:o(e.value)}:{blurred:!0})}(e,t);case"dirty":return function(e){return a({},e,{dirty:!0,pristine:!1})}(e);case"validate":return function(e,t){var n,i;return a({},e,{validity:(null!=(n=null==(i=t.configuration)?void 0:i.validate)?n:e.configuration.validate)(e.value)})}(e,t);default:throw new Error("Invalid action type")}},o={dirty:!1,pristine:!0,invalid:!0,valid:!1,submitted:!1,changed:!1,blurred:0,fieldsData:new Map,configuration:{name:"",validateOnBlur:!0,validateOnChange:!1}},d=function(e){var t=f(e.fieldsData);return a({},e,{invalid:!t,valid:t})},f=function(e){if(!e)return!1;for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,void 0):void 0}}(e))){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(t=n()).done;)if(!t.value[1].validity.valid)return!1;return!0},c=function(e,t){switch(t.type){case"submit":return function(e){return a({},e,d(e),{submitted:!0})}(e);case"change":return function(e,t){var n=a({},e,{changed:!0}),i=t.fieldState;return n.fieldsData.set(i.configuration.name,i),e.configuration.validateOnChange&&(n.dirty=!0,n.pristine=!1,n=d(n)),n}(e,t);case"blur":return function(e,t){var n,i=a({},e,{blurred:e.blurred+1}),r=t.fieldState;return i.fieldsData.set(r.configuration.name,r),e.configuration.validateOnBlur&&e.changed?(i.dirty=!0,i.pristine=!1,(n=i.fieldsData).forEach((function(e,t){!e.changed||e.dirty||e.configuration.validateOnChange||n.set(t,u(u(e,{type:"dirty"}),{type:"validate"}))})),i=d(i)):i}(e,t);case"validate":return d(e);case"registerField":return function(e,t){e.fieldsData=new Map(e.fieldsData);var n=t.fieldState;return e.fieldsData.set(n.configuration.name,n),d(e)}(e,t);case"setField":return function(e,t){var n=t.fieldState;return e.fieldsData.set(n.configuration.name,n),d(e)}(e,t);case"unregisterField":return function(e,t){return e.fieldsData=new Map(e.fieldsData),e.fieldsData.delete(t.fieldState.configuration.name),d(e)}(e,t);default:throw new Error}},v=t.createContext({state:o,setFieldState:function(){},setFieldValue:function(){},dispatch:function(){}}),s=v.Provider,g=v.Consumer;function p(){return t.useContext(v)}v.displayName="FormContext";var y={valid:!0},h=function(){return y},m=function(e){var n=e.initialValue,a=e.onChange,i=void 0===a?function(){}:a,r=e.onFocus,l=void 0===r?function(){}:r,o=e.onBlur,d=void 0===o?function(){}:o,f=e.children,c=e.formContext,v=e.state,s=c.dispatch,g=t.useRef(),p=t.useRef(!1);return t.useEffect((function(){var e;if(p.current){var t=null!=(e=null==n?void 0:n.toString())?e:"";s({type:"change",fieldState:u(v,{value:t,type:"change",configuration:{validateOnChange:!0}})})}}),[n]),t.useEffect((function(){return p.current=!0,s({type:"registerField",fieldState:u(v,{type:"validate"})}),function(){s({type:"unregisterField",fieldState:v})}}),[]),f({fieldProps:{value:v.value,ref:g,onChange:function(e){var t=g.current.value;s({type:"change",fieldState:u(v,{value:t,type:"change"})}),i(e,t)},onBlur:function(e){d(e),s({type:"blur",fieldState:u(v,{type:"blur"})})},onFocus:function(e){l(e)}},fieldState:v,formContext:c})};exports.ArkField=function(e){var i,l,u,o,d,f,c,v,s,g,y=p(),b=y.state,O=null!=(i=b.fieldsData.get(e.name))?i:(u=b.configuration,g=null!=(o=null==(d=(l=e).initialValue)?void 0:d.toString())?o:"",a({},r,{value:g,filled:!!g,configuration:{validateOnChange:null==(f=null!=(c=l.validateOnChange)?c:u.validateOnChange)||f,validateOnBlur:null!=(v=u.validateOnBlur)&&v,validate:null!=(s=l.validate)?s:h,name:l.name}}));return t.useMemo((function(){return n.createElement(m,Object.assign({},e,{formContext:y,state:O}))}),[b.blurred,b.submitted,b.valid,b.dirty,b.changed,b.fieldsData,e.initialValue,e.validate,null==O?void 0:O.changed,null==O?void 0:O.validity,null==O?void 0:O.blurred,null==O?void 0:O.dirty,null==O?void 0:O.pristine,null==O?void 0:O.filled])},exports.ArkForm=function(e){var i=e.name,r=e.onSubmit,d=e.children,f=e.validateOnChange,v=void 0!==f&&f,g=e.validateOnBlur,p=void 0===g||g,y=t.useReducer(c,o,(function(e){return e.fieldsData=new Map,e.configuration={validateOnChange:v,validateOnBlur:p,name:i},e})),h=y[0],m=y[1],b=function(e){var t=h.fieldsData.get(e);if(!t)throw"field name is incorrect";return t},O={name:i,onSubmit:function(e){e.preventDefault(),m({type:"submit"}),h.valid&&r(e,h.fieldsData)}},S={state:h,setFieldState:function(e,t){var n=l(b(e),t),a=u(n,{type:"validate"});m({type:"setField",fieldState:a})},setFieldValue:function(e,t,n){var i=b(e),r=u(i,{value:t,type:"change",configuration:a({},i.configuration,n,{validateOnChange:!0})});m({type:"change",fieldState:r}),m({type:"validate"})},dispatch:m};return n.createElement(s,{value:S},d(a({},S,{formProps:O})))},exports.FormConsumer=g,exports.FormContext=v,exports.FormProvider=s,exports.defaultFieldState=r,exports.defaultFormState=o,exports.fieldReducer=u,exports.formReducer=c,exports.mergeState=l,exports.useFormContext=p;
//# sourceMappingURL=ark-forms.cjs.production.min.js.map
